<!-- ------------------------------------------------------------------------------------------- -->
<!--  Redmine CMDB plugin: Configuration Management DataBase                                     -->
<!--  Copyright (C) 2025 Franz Apeltauer                                                         -->
<!--                                                                                             -->
<!--  This program is free software: you can redistribute it and/or modify it under the terms    -->
<!--  of the GNU Affero General Public License as published by the Free Software Foundation,     -->
<!--  either version 3 of the License, or (at your option) any later version.                    -->
<!--                                                                                             -->
<!--  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;  -->
<!--  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  -->
<!--  See the GNU Affero General Public License for more details.                                -->
<!--                                                                                             -->
<!--  You should have received a copy of the GNU Affero General Public License                   -->
<!--  along with this program.  If not, see <https://www.gnu.org/licenses/>.                     -->
<!-- -------------------------------------------------------------------------------------eohdr- -->
<%# Purpose: Partial injected into issue pages to display associated CIs.
            Shows CI list in issue view with add/remove functionality when CMDB module is enabled. %>

<% if @issue.project.module_enabled?(:cmdb) && (@issue.cis.any? || @issue.editable?) %>
  <div id="issue-cis-section" class="issue-cis-section" data-issue-id="<%= @issue.id %>">
    <hr>
    <div class="contextual">
      <% if @issue.editable? %>
        <%= link_to l(:label_add_ci),
                    '#',
                    class: 'icon icon-add',
                    id: 'add-ci-link',
                    onclick: 'IssueCis.openModal(); return false;' %>
      <% end %>
    </div>

    <h3><%= l(:label_configuration_items) %></h3>

    <div id="issue-cis-list">
      <% if @issue.cis.any? %>
        <table class="list issue-cis-table">
          <thead>
            <tr>
              <th><%= l(:field_name) %></th>
              <th><%= l(:label_ci_class) %></th>
              <th><%= l(:label_location) %></th>
              <th><%= l(:label_lifecycle_status) %></th>
              <% if @issue.editable? %>
                <th style="width: 15%;"></th>
              <% end %>
            </tr>
          </thead>
          <tbody id="ci-rows">
            <% @issue.cis.each do |ci| %>
              <%= render partial: 'issue_cis/ci_row', locals: { ci: ci, issue: @issue } %>
            <% end %>
          </tbody>
        </table>
      <% end %>
    </div>
  </div>

  <!-- CI Selection Modal -->
  <%= render partial: 'issue_cis/ci_selection_modal' %>
<% end %>
